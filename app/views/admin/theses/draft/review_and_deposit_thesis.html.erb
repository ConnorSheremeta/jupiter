<% page_title(t('.header')) %>

<div class="container mt-3">
  <%= render partial: 'progress_bar' %>

  <h2 class="mt-3">
    <%= fa_icon t('.header_icon') %>
    <%= @is_edit ? t('.header_edit') : t('.header') %>
  </h2>

  <%= simple_form_for @draft_thesis, url: wizard_path, method: :put, html: { class:'js-deposit-item' } do |f| %>
    <p><%= t('.please_review_thesis') %></p>

    <div class="row">

      <div class="col-md-4">

        <div class="card mb-3">
          <div class="card-header">
            <%= link_to wizard_path(:upload_files), class: 'float-right' do %>
              <%= fa_icon 'pencil-square-o' %>
              <%= t('edit') %>
            <% end %>
            <%=  t('admin.theses.draft.upload_files.header') %>
          </div>

          <div class="card-body">
            <%= render partial: 'feature_image', locals: { feature_image: @draft_thesis.thumbnail, object: @draft_thesis } %>

            <ul class="list-group mt-3">
              <% @draft_thesis.files.each do |file|%>
                <li class="list-group-item">
                  <%= fa_icon file_icon(file.content_type) %>
                  <%=file.filename %>
                  <span class="badge badge-primary badge-pill float-right">
                  <%= number_to_human_size(file.byte_size) %>
                  </span>
                </li>
              <% end %>
            </ul>
          </div>
        </div>
        <div class="card mb-3">
          <div class="card-header">
            <%= link_to wizard_path(:choose_license_and_visibility), class: 'float-right' do %>
              <%= fa_icon 'pencil-square-o' %>
              <%= t('edit') %>
            <% end %>
            <%=  t('admin.theses.draft.choose_license_and_visibility.header') %>
          </div>
          <div class="card-body">
            <h4 class="card-title">License</h4>
            <p class="card-text">
              <% if @draft_thesis.rights.present? %>
                <%= @draft_thesis.rights %>
              <% end %>
            </p>
            <h4 class="card-title">Visibility</h4>
              <p class="card-text">
                <%= t("admin.theses.draft.choose_license_and_visibility.visibility.#{@draft_thesis.visibility}") %>
                <% if @draft_thesis.embargo? %>
                  <%= jupiter_time_tag(@draft_thesis.embargo_end_date) %>
                <% end %>
              </p>
          </div>
        </div>
      </div>

      <div class="col-md-8">
        <div class="card mb-3">
          <div class="card-header">
            <%= link_to wizard_path(:describe_thesis), class: 'float-right' do %>
              <%= fa_icon 'pencil-square-o' %>
              <%= t('edit') %>
            <% end %>
            <%= t('admin.theses.draft.describe_thesis.header') %>
          </div>
          <div class="card-body">
            <h6 class="card-subtitle mb-1 text-muted">
              <%= t('admin.theses.draft.describe_thesis.title') %>
            </h6>
            <p class="card-text"><%= @draft_thesis.title %></p>

            <% if @draft_thesis.alternate_title.present? %>
              <h6 class="card-subtitle mb-1 text-muted">
                <%= t('admin.theses.draft.describe_thesis.alternate_title') %>
              </h6>
              <p class="card-text"><%= @draft_thesis.alternate_title %></p>
            <% end %>

            <% if @draft_thesis.language.present? %>
              <h6 class="card-subtitle mb-1 text-muted">
                <%= t('admin.theses.draft.describe_thesis.language') %>
              </h6>
              <p class="card-text">
                <%= @draft_thesis.language.translated_name %>
              </p>
            <% end %>

            <h6 class="card-subtitle mb-1 text-muted">
              <%= t('admin.theses.draft.describe_thesis.creator') %>
            </h6>
            <p class="card-text"><%= @draft_thesis.creator %></p>

            <% if @draft_thesis.subjects.present? %>
              <h6 class="card-subtitle mb-1 text-muted">
                <%=  t('admin.theses.draft.describe_thesis.subjects') %>
              </h6>
              <ul>
                <% @draft_thesis.subjects.each do |subject| %>
                <li><%= subject %></li>
                <% end %>
              </ul>
            <% end %>

            <h6 class="card-subtitle mb-1 text-muted">
              <%= t('admin.theses.draft.describe_thesis.description') %>
            </h6>
            <p class="card-text">
              <%= @draft_thesis.description %>
            </p>

            <h6 class="card-subtitle mb-1 text-muted">
              <%= t('admin.theses.draft.describe_thesis.graduation_term') %>
            </h6>
            <p class="card-text">
              <%= @draft_thesis.graduation_term %>
            </p>

            <h6 class="card-subtitle mb-1 text-muted">
              <%= t('admin.theses.draft.describe_thesis.graduation_year') %>
            </h6>
            <p class="card-text">
              <%= @draft_thesis.graduation_year %>
            </p>

            <h6 class="card-subtitle mb-1 text-muted">
              <%= t('admin.theses.draft.describe_thesis.community_and_collection') %>
            </h6>
            <ul>
              <% @draft_thesis.each_community_collection do |community, collection| %>
                <li>
                  <%= community.title %>
                  /
                  <%= collection.title %>
                </li>
              <% end %>
            </ul>

            <% if @draft_thesis.date_submitted.present? %>
              <h6 class="card-subtitle mb-1 text-muted">
                <%= t('admin.theses.draft.describe_thesis.date_submitted') %>
              </h6>
              <p class="card-text"><%= jupiter_time_tag(@draft_thesis.date_submitted) %></p>
            <% end %>

            <% if @draft_thesis.date_accepted.present? %>
              <h6 class="card-subtitle mb-1 text-muted">
                <%= t('admin.theses.draft.describe_thesis.date_accepted') %>
              </h6>
              <p class="card-text"><%= jupiter_time_tag(@draft_thesis.date_accepted) %></p>
            <% end %>

            <% if @draft_thesis.degree_level.present? %>
              <h6 class="card-subtitle mb-1 text-muted">
                <%= t('admin.theses.draft.describe_thesis.degree_level') %>
              </h6>
              <p class="card-text"><%= @draft_thesis.degree_level %></p>
            <% end %>

            <% if @draft_thesis.degree.present? %>
              <h6 class="card-subtitle mb-1 text-muted">
                <%= t('admin.theses.draft.describe_thesis.degree') %>
              </h6>
              <p class="card-text"><%= @draft_thesis.degree %></p>
            <% end %>

            <% if @draft_thesis.specialization.present? %>
              <h6 class="card-subtitle mb-1 text-muted">
                <%= t('admin.theses.draft.describe_thesis.specialization') %>
              </h6>
              <p class="card-text"><%= @draft_thesis.specialization %></p>
            <% end %>

            <% if @draft_thesis.institution.present? %>
              <h6 class="card-subtitle mb-1 text-muted">
                <%= t('admin.theses.draft.describe_thesis.institution_id') %>
              </h6>
              <p class="card-text">
                <%= @draft_thesis.institution.translated_name %>
              </p>
            <% end %>

            <% if @draft_thesis.departments.present? %>
              <h6 class="card-subtitle mb-1 text-muted">
                <%=  t('admin.theses.draft.describe_thesis.departments') %>
              </h6>
              <ul>
                <% @draft_thesis.departments.each do |subject| %>
                <li><%= subject %></li>
                <% end %>
              </ul>
            <% end %>

            <% if @draft_thesis.supervisors.present? %>
              <h6 class="card-subtitle mb-1 text-muted">
                <%=  t('admin.theses.draft.describe_thesis.supervisors') %>
              </h6>
              <ul>
                <% @draft_thesis.supervisors.each do |subject| %>
                <li><%= subject %></li>
                <% end %>
              </ul>
            <% end %>

            <% if @draft_thesis.committee_members.present? %>
              <h6 class="card-subtitle mb-1 text-muted">
                <%=  t('admin.theses.draft.describe_thesis.committee_members') %>
              </h6>
              <ul>
                <% @draft_thesis.committee_members.each do |subject| %>
                <li><%= subject %></li>
                <% end %>
              </ul>
            <% end %>





          </div>
        </div>

        <p><%= t('.legal_disclaimer_html') %></p>
        <div class="mb-3 d-flex flex-wrap justify-content-end">
          <%= link_to previous_wizard_path, class: 'btn btn-secondary mr-2' do %>
            <%= fa_icon 'chevron-left' %>
            <%= t('admin.theses.draft.previous') %>
          <% end %>
          <%= button_tag type: :submit, class: 'btn btn-primary', data: { disable_with: t('admin.theses.draft.submit_draft_btn_loading_html') } do %>
            <%= fa_icon 'save' %>
            <% if @is_edit %>
              <%= t('admin.theses.draft.save_and_deposit_edits') %>
            <% else %>
              <%= t('admin.theses.draft.header') %>
            <% end %>
          <% end %>
        </div>
      </div>
    </div>
  <% end %>
</div>
